<!DOCTYPE html>
<html>
<head>
    <title>EMDR Tapper</title>
    <script>
        async function runTapperPattern() {
            const gamepads = navigator.getGamepads();
            const joycons = Array.from(gamepads).filter(gp => gp && gp.vibrationActuator);

            if (joycons.length < 2) {
                alert("Two Joy-Cons are required for the tapper pattern.");
                return;
            }

            for (let i = 0; i < 4; i++) { // Repeat pattern 4 times
                await joycons[0].vibrationActuator.playEffect("dual-rumble", {
                    startDelay: 0,
                    duration: 500,
                    strongMagnitude: 1.0,
                    weakMagnitude: 0.0
                });
                await new Promise(resolve => setTimeout(resolve, 500));

                await joycons[1].vibrationActuator.playEffect("dual-rumble", {
                    startDelay: 0,
                    duration: 500,
                    strongMagnitude: 1.0,
                    weakMagnitude: 0.0
                });
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        function pollGamepadInput() {
            const gamepads = navigator.getGamepads();
            for (const gamepad of gamepads) {
                if (gamepad && gamepad.buttons[7]?.pressed) { // Right Trigger
                    runTapperPattern();
                }
            }
            requestAnimationFrame(pollGamepadInput);
        }

        window.addEventListener("gamepadconnected", pollGamepadInput);
    </script>
</head>
<body>
    <h1>EMDR Tapper</h1>
    <button onclick="runTapperPattern()">Start Tapper Pattern</button>
</body>
</html>
